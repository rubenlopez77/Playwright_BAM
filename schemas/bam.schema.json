{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "BAM Execution Report Schema v0.1.7",
  "type": "object",

  "properties": {
    "testSession": {
      "type": "object",
      "required": ["testPlan", "testCycle", "testRun", "tester"],
      "properties": {
        "testPlan": { "type": "string" },
        "testCycle": { "type": "string" },
        "testRun": { "type": "string" },
        "tester": { "type": "string" },
        "executionEnvironment": { "type": "string" },
        "startTime": { "type": "string", "format": "date-time" },
        "endTime": { "type": "string", "format": "date-time" }
      }
    },

    "metadata": {
      "type": "object",
      "required": ["id", "title", "description"],
      "properties": {
        "id": { "type": "string" },
        "title": { "type": "string" },
        "description": { "type": "string" },
        "requirements": {
          "type": "array",
          "items": { "type": "string" }
        },
        "userStories": {
          "type": "array",
          "items": { "type": "string" }
        },
        "acceptanceCriteria": {
          "type": "array",
          "items": { "type": "string" }
        },
        "priority": { "type": "string", "enum": ["LOW", "MEDIUM", "HIGH", "CRITICAL"] },
        "risk": { "type": "string", "enum": ["LOW", "MEDIUM", "HIGH"] },
        "businessImpact": { "type": "string", "enum": ["LOW", "MEDIUM", "HIGH", "CRITICAL"] },
        "preconditions": {
          "type": "array",
          "items": { "type": "string" }
        },
        "testData": {
          "type": "array",
          "items": { "type": "string" }
        },
        "component": { "type": "string" },
        "module": { "type": "string" },
        "labels": {
          "type": "array",
          "items": { "type": "string" }
        },
        "owner": { "type": "string" }
      }
    },

    "execution": {
      "type": "object",
      "required": ["browser", "worker", "status", "startTime", "endTime", "durationMs"],
      "properties": {
        "browser": { "type": "string" },
        "worker": { "type": "integer" },
        "status": { "type": "string", "enum": ["PASSED", "FAILED", "SKIPPED"] },
        "startTime": { "type": "string", "format": "date-time" },
        "endTime": { "type": "string", "format": "date-time" },
        "durationMs": { "type": "number" }
      }
    },

    "steps": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["keyword", "text", "status", "timestamp"],
        "properties": {
          "keyword": {
            "type": "string",
            "enum": ["Given", "When", "Then", "And", "But"]
          },
          "text": { "type": "string" },
          "status": { "type": "string", "enum": ["PASSED", "FAILED", "SKIPPED"] },
          "timestamp": { "type": "string", "format": "date-time" }
        }
      }
    },

    "actions": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["component", "action", "duration", "success", "timestamp"],
        "properties": {
          "component": { "type": "string" },
          "action": { "type": "string" },
          "selector": { "type": "string" },
          "duration": { "type": "number" },
          "success": { "type": "boolean" },
          "timestamp": { "type": "string", "format": "date-time" },
          "boundStep": { "type": "string" }
        }
      }
    },

    "evidences": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["type", "name", "path"],
        "properties": {
          "type": { "type": "string", "enum": ["screenshot", "video", "log", "trace", "custom"] },
          "name": { "type": "string" },
          "path": { "type": "string" }
        }
      }
    },

    "incidents": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["step", "expected", "actual", "errorMessage", "timestamp", "severity"],
        "properties": {
          "step": { "type": "string" },
          "expected": { "type": "string" },
          "actual": { "type": "string" },
          "errorMessage": { "type": "string" },
          "timestamp": { "type": "string", "format": "date-time" },
          "severity": { "type": "string", "enum": ["LOW", "MEDIUM", "HIGH", "CRITICAL", "BLOCKER"] },
          "reproducibility": { "type": "string", "enum": ["ALWAYS", "SOMETIMES", "RARE", "UNKNOWN"] },

          "defect": {
            "type": "object",
            "required": ["defectId", "defectStatus", "severity", "reproducibility"],
            "properties": {
              "defectId": { "type": "string" },
              "defectStatus": { "type": "string", "enum": ["OPEN", "IN_PROGRESS", "RESOLVED", "CLOSED"] },
              "severity": { "type": "string", "enum": ["LOW", "MEDIUM", "HIGH", "CRITICAL", "BLOCKER"] },
              "reproducibility": { "type": "string", "enum": ["ALWAYS", "SOMETIMES", "RARE", "UNKNOWN"] }
            }
          }
        }
      }
    },

    "metrics": {
      "type": "object",
      "properties": {
        "performance": {
          "type": "object",
          "properties": {
            "totalDurationMs": { "type": "number" },
            "avgActionDurationMs": { "type": "number" }
          }
        },
        "reliability": {
          "type": "object",
          "properties": {
            "status": { "type": "string" },
            "failRate": { "type": "number" }
          }
        },
        "efficiency": {
          "type": "object",
          "properties": {
            "actionsCount": { "type": "integer" },
            "stepsCount": { "type": "integer" }
          }
        },
        "maintainability": {
          "type": "object",
          "properties": {
            "componentsUsed": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        },
        "functionalSuitability": {
          "type": "object",
          "properties": {
            "requirementsCovered": {
              "type": "array",
              "items": { "type": "string" }
            },
            "acCovered": { "type": "integer" }
          }
        }
      }
    }
  },

  "required": [
    "testSession",
    "metadata",
    "execution",
    "steps",
    "actions"
  ]
}
